name: Fast CI
on: [push, pull_request]

jobs:
  fast-check:
    runs-on: ubuntu-latest
    timeout-minutes: 1  # Только 1 минута!
    
    services:
      postgres:
        image: postgres:13
        env:
          POSTGRES_PASSWORD: password
          POSTGRES_DB: etl_db
          POSTGRES_USER: user
        ports:
          - 5432:5432

    steps:
    - uses: actions/checkout@v4
    
    - name: Wait for PostgreSQL
      run: |
        echo "Waiting for PostgreSQL..."
        for i in {1..10}; do
          if pg_isready -h localhost -p 5432; then
            echo "PostgreSQL is ready!"
            exit 0
          fi
          echo "Waiting... ($i/10)"
          sleep 3
        done
        echo "PostgreSQL failed to start"
        exit 1
        
    - name: Simple connection test
      run: |
        python -c "
        import psycopg2
        try:
            conn = psycopg2.connect(
                host='localhost',
                port=5432,
                database='etl_db',
                user='user',
                password='password'
            )
            conn.close()
            print('✅ SUCCESS: Can connect to PostgreSQL')
        except Exception as e:
            print(f'❌ FAILED: {e}')
            exit(1)
        "